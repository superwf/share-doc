<!--
è«é“å›è¡Œæ—©ï¼Œæ›´æœ‰æ—©è¡Œäºº
å±±ä¸­æœ‰ç›´æ ‘ï¼Œä¸–ä¸Šæ— ç›´äººã€‚
åŠ›å¾®ä¼‘è´Ÿé‡ï¼Œè¨€è½»è«åŠäººã€‚
ä¸€åˆ‡éƒ½æ˜¯å‘½ï¼ŒåŠç‚¹ä¸ç”±äººã€‚
-->

# è¯­æ³•æ ‘ç®€ä»‹

## è¯­æ³•æ ‘æ˜¯å¹²å˜›åœ°

é¦–å…ˆè¯´ï¼Œè¯­æ³•æ ‘æ˜¯ä¸€ä¸ªä¸­è¯­è¨€åˆ†ææ¨¡å¼ï¼Œæœ‰å¾ˆå¤šä¸­è¯­è¨€çš„å„ç§å®ç°ï¼Œå¹¶ä¸æŒ‡å•ä¸€å·¥å…·æˆ–ç¯å¢ƒã€‚

æœ€å¥½çš„æ¯”å–»ï¼šdom æ ‘ï¼Œç»è¿‡è¯­æ³•æ ‘å·¥å…·è½¬æ¢çš„æºç ä¼šå½¢æˆ dom æ ‘ä¸€æ ·çš„å±‚å±‚èŠ‚ç‚¹æ„æˆçš„ç»“æ„ã€‚

ä½œç”¨å¤§ä½“æœ‰ï¼šç¼–è¯‘æœŸè¯­æ³•æ£€æŸ¥ã€è¯­ä¹‰æ£€æŸ¥ï¼Œideè‡ªåŠ¨è¡¥å…¨ã€‚

æœ€é‡è¦çš„æ ¸å¿ƒåŠŸèƒ½ï¼šç°æœ‰è¯­æ³•æ‰©å±•ã€‚

1. æ–°è¯­æ³•è¿è¡Œç¯å¢ƒä¸æ”¯æŒï¼Ÿè‡ªåŠ›æ›´ç”Ÿï¼è¯­æ³•æ ‘å¸®ä½ è½¬åŒ–é™çº§ä¸ºæ—§è¯­æ³•ã€‚

1. è‡ªé€ æ–°è¯­æ³•ç³–ï¼ˆæ„Ÿè§‰ç±»ä¼¼å®ï¼‰ã€‚è™½ç„¶å¯ä»¥ï¼Œä½†ä¸è¦èƒŒç¦»ä¸»è¯­æ³•ä¸ºå¥½ã€‚

1. æºç å‹ç¼©ï¼Œå¦‚`terser`/`uglifyjs`ï¼Œå°†å˜é‡åç­‰åœ¨è¿è¡Œæ—¶æœ€å°åŒ–ã€‚

1. æºç å¤šç¯å¢ƒè½¬æ¢

    > ä¾‹å¦‚å°ç¨‹åºä¸€æ¬¡ç¼–å†™ï¼Œè‡ªåŠ¨ç¼–è¯‘å¤šä¸ªå¹³å°é€‚é…ä»£ç ã€‚

    > è¿˜ä¾‹å¦‚æœ¬åœ°è¿è¡Œçš„ç¨‹åºï¼Œè½¬æ¢åå¯ä»¥åœ¨æµè§ˆå™¨è¿è¡Œã€‚

1. è°ƒè¯•æ—¶ï¼Œæç¤ºä¿¡æ¯å¯ä»¥å®šä½åˆ°æºç çš„åŸå§‹ä½ç½®ã€‚

1. ç»Ÿè®¡æµ‹è¯•è¦†ç›–ç‡ï¼Œä»£ç æ‰«æç­‰ï¼Œä¸€å®šæœ‰è¯­æ³•æ ‘çš„ä½¿ç”¨åœºæ™¯ã€‚

1. æ¡†æ¶å‡çº§ï¼Œå½“æ–°ç‰ˆæœ¬åŠŸèƒ½èƒ½å®Œå…¨è¦†ç›–æ—§ç‰ˆæœ¬æ—¶ï¼Œåˆ©ç”¨è¯­æ³•æ ‘å¯ç²¾ç¡®å°†æ—§æ¡†æ¶è½¬æ¢ä¸ºæ–°æ¡†æ¶å¯¹åº”ä»£ç ã€‚ğŸ™

1. åŠ¨æ€æ³¨å…¥å…¶ä»–æ•°æ®ä¿¡æ¯ã€‚

1. è‡ªåˆ›æ–°è¯­è¨€ï¼Œç›®å‰å‰ç«¯ç”Ÿæ€åœˆå¦‚æ­¤å‘è¾¾ï¼Œå„ç§æ–°è¯­è¨€éƒ½é€šè¿‡è¯­æ³•æ ‘çš„åŠ æŒè½¬æ¢æˆè¿è¡Œæ—¶çš„`javascript`ï¼Œä¾‹å¦‚`typescript`ã€`elm`ã€`coffeescript`ã€`purescript`ç­‰ç­‰ã€‚

1. è‡ªåˆ›`dsl(Domain Specified Language)`ï¼Œåªè¦ç¨å¾®æƒ³æœ‰ç‚¹åŠ¨æ€åŠŸèƒ½ï¼Œå°±å¯ä»¥åˆ©ç”¨è¯­æ³•æ ‘æ¨¡å¼ï¼Œå°†è‡ªå·±çš„`dsl`ç²¾å‡†è§£æå¹¶è½¬æ¢ä¸ºæˆ‘ä»¬ç†Ÿæ‚‰è¯­è¨€çš„å¯è¿è¡Œç¨‹åºã€‚

æ€»ç»“ï¼šèƒ½ç²¾å‡†è¯»å–æˆ–æ“ä½œæºç çš„å”¯ä¸€å·¥å…·

ä½¿ç”¨æ­£åˆ™åŠ å­—ç¬¦ä¸²æ¨¡æ¿å¥½æ¯”å¤§ç åˆ€ï¼Œè¯­æ³•æ ‘å°±å¥½æ¯”æ‰‹æœ¯åˆ€ï¼Œè™½ç„¶éš¾ä½†è´µåœ¨ç²¾å‡†æ§åˆ¶ã€‚

## å¦‚ä½•ç”¨

ç”¨ä¸€ä¸ªæ–°è¯­æ³•â€”â€”ä¿®é¥°å™¨åšä¾‹å­ï¼Œå› ä¸ºå’Œ`java`çš„æ³¨è§£è¯­æ³•å¾ˆåƒã€‚

ä¸ºäº†å®ç°ä¸ºä¸€ä¸ª`class`æ·»åŠ ä¸€ä¸ªç±»å±æ€§åç§°`displayName`

æ–°è¯­æ³•

```javascript
@addDisplayName('myClassIsPerfet')
export class A { ... }
```

æ—§è¯­æ³•

```javascript
function addDisplayName (name) {
  return function(myclass) {
    _A.displayName = name
    return _A
  }
}
class _A { ... }

export const A = addDisplayName('myClassIsPerfet')(_A)
```

é€šè¿‡`babel`çš„ä¸€ä¸ª`plugin`ï¼š`@babel/plugin-proposal-decorators`ï¼Œå³å¯è¾¾åˆ°

å¦‚æœæ²¡æœ‰è¯­æ³•æ ‘ï¼Œç”¨æ­£åˆ™æ›¿æ¢å­—ç¬¦ä¸²çš„è·¯å­ï¼Œå‘ƒï¼Œç®€ç›´ä¸å¯æƒ³è±¡ã€‚

å‘µå‘µï¼Œåœ¨çŸ¥é“è¯­æ³•æ ‘ä¹‹å‰æˆ‘å°±æ˜¯è¿™ä¹ˆæçš„ï¼Œç»“æœå„ç§æ¼æ´å’Œåšä¸åˆ°ã€‚

æ¯”å¦‚è¦æ›¿æ¢ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°åï¼Œè¿™ä¸ªåå­—å¯èƒ½æœ‰é‡å‘½åçš„åˆ«åï¼Œåœ¨æ³¨é‡Šä¸­çš„æƒ…å†µï¼Œåœ¨å­—ç¬¦ä¸²ä¸­ä¹Ÿæœ‰è¿™ç§åç§°ï¼Œè¿˜å¾—è½¬ä¹‰ï¼Œåœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­é‡åçš„é—®é¢˜ï¼Œå¯¼è‡´æ­£åˆ™æ›¿æ¢å®Œå…¨æ²¡è¾™ã€‚

æœ€ç»ˆçš„ç»“æœå°±æ˜¯ï¼šä¿ºæ’‚æŒ‘å­äº†ï¼Œè¿™æ´»å°±è¿™æ ·äº†ï¼Œå®¢æˆ·å¤§çˆ·ä»¬å‡‘åˆç”¨å§ã€‚

### pluginå®ç°ä»£ç æ ·ä¾‹

ä¸Šé¢é‚£ä¸ªè½¬æ¢ä¿®é¥°å™¨çš„ä¾‹å­å¦‚æœç”¨è¯­æ³•æ ‘å†™è½¬æ¢å¤ªå¤æ‚ã€‚

ä¸‹é¢ç”¨ä¸€ä¸ªå»é™¤`debugger`çš„è½¬æ¢åšä¾‹å­ã€‚

```javascript
module.exports = function() {
  return {
    visitor: {
      DebuggerStatement: function(path) {
        path.remove();
      }
    }
  };
};
```

### å·¥å…·ç”Ÿæ€

#### babel && acorn

acorn => babylon => babel-parser

[å¼•ç”¨èµ„æ–™](https://xiaohesong.gitbook.io/today-i-learn/front-end/webpack/babel/babelparser-he-acorn-de-qu-bie)

##### åœ¨çº¿ç¤ºä¾‹ï¼Œå¯ä»¥æœ€ç›´è§‚çš„å®æ—¶äº†è§£æºç ä¸è¯­æ³•æ ‘çš„å¯¹åº”å…³ç³»

[astexplorer](https://astexplorer.net/)

ä¸å…‰æ˜¯æ™®é€šç¼–ç¨‹è¯­è¨€æœ‰è¯­æ³•æ ‘ï¼ŒSQLä¹Ÿæœ‰ï¼Œå¯ä»¥ç”¨SQLçš„è¯­æ³•æ ‘å·¥å…·ç²¾å‡†æ“ä½œSQLè¯­å¥ã€‚

#### typescript

[è§£ææµ](https://jkchao.github.io/typescript-book-chinese/compiler/overview.html#%E6%96%87%E4%BB%B6%EF%BC%9Autilities)

### ä½•ä¸ºè¯­æ³•ä¸è¯­ä¹‰

```typescript
var foo: number = 'not a number';
```

è¯­æ³•æ­£ç¡®ï¼Œè¯­ä¹‰ä¸åˆæ³•ã€‚

#### language-server

ä¸€ä¸ªå†…å­˜ä¸­è¿è¡Œçš„å¿«é€Ÿåé¦ˆçš„è¿›ç¨‹ï¼Œç°ä»£ideå¿…å¤‡é…ç½®ã€‚

å¤§å¾®è½¯å‡ºå“ï¼Œæœ€åˆæ˜¯`typescript-language-server`ï¼Œç›®å‰å·²ç»æ‰©å±•åˆ°å„ä¸ªè¯­è¨€çš„ç”Ÿæ€ã€‚

[å·²æ”¯æŒè¯­è¨€](https://microsoft.github.io/language-server-protocol/implementors/servers/)

`Language Server`è§£å†³äº†ç¼–è¾‘å™¨(m)å’Œé‚£ä¹ˆå¤šè¯­è¨€(n)å…±å­˜çš„é—®é¢˜,ä»¥å‰å†™ç¼–è¾‘å™¨è¯­è¨€æ’ä»¶è¦å†™ m \* n ä¸ª, LSPå‡ºç°ååªè¦å†™ m + n ä¸ªå°±å¯ä»¥äº†ã€‚

æ›´åˆ«ææ¯ä¸ªè¯­è¨€è¿˜æœ‰æ— æ•°çš„å°ç‰ˆæœ¬ï¼è¦æ˜¯æ²¡æœ‰LSPï¼Œå¾— m \* n \* v ä¸ªæ’ä»¶ï¼Œåˆ«è¯´ç¼–å†™çš„äººï¼Œç”¨çš„éƒ½å¾—ç–¯ï¼Œæˆ–è€…å°±æ˜¯å’±ä¹Ÿäº’ç›¸ä½“è°…ä¸€ä¸‹ï¼Œå‡‘åˆèƒ½ç”¨å°±è¡Œå§ã€‚

è¿›ç¨‹ä¸å¤–éƒ¨äº¤äº’æœ‰ä¸“ç”¨çš„é€šç”¨åè®®[language-server-protocol](https://microsoft.github.io/language-server-protocol/)

ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ç°ä¸€ç§è¯­è¨€çš„`language-server`ä¸ä¸€å®šå¿…é¡»ç”¨è¯¥è¯­è¨€æœ¬èº«ï¼Œæ¯”å¦‚å¯ä»¥ç”¨javascriptå†™ä¸€ä¸ªluaçš„`language-server`ï¼Œåªè¦ä½¿ç”¨LSPåè®®äº¤äº’æ•°æ®å³å¯ã€‚

å¦å¤–ä¸€å¤§å¥½å¤„æ˜¯ï¼Œè¯­æ³•è¡¥å…¨è¶Šæ¥è¶Šæ™ºèƒ½ï¼Œèƒ½æ ¹æ®å½“å‰è¾“å…¥æ‰€åœ¨ä½ç½®çš„ä¸Šä¸‹æ–‡ï¼Œç²¾å‡†ç»™å‡ºè¡¥å…¨åˆ—è¡¨ã€‚ä¸åƒè€å¼ideä»…èƒ½é è¯­è¨€å…³é”®å­—æç¤ºã€‚

## å…¶ä»–ç›¸å…³

å‰ç«¯ç¯å¢ƒä¸­çš„è¯­æ³•æ ‘ä¸æ­¢åŒ…å«ä»¥ä¸Šè¿™äº›å·¥å…·ï¼Œè¿˜æœ‰ä¾‹å¦‚ï¼š

`esprima`ã€`eslint-ast`ã€`esbuild`ã€`uglifyjs`ã€`terser`ç­‰

<details><summary>æé—®æ—¶é—´</summary>

åˆ«é—®ï¼Œé—®å¤šäº†æˆ‘ä¹Ÿä¸çŸ¥é“

![](http://img.pkdoutu.com/production/uploads/image/2022/01/13/20220113045451_njlcId.jpg)

</details>

## ç•™ä¸ªä½œä¸š

ä¸å…‰æ˜¯æ™®é€šç¼–ç¨‹è¯­è¨€æœ‰è¯­æ³•æ ‘ï¼ŒSQLä¹Ÿæœ‰ï¼Œåœ¨çº¿demoå¯ä»¥åœ¨[astexplorer](https://astexplorer.net/)æŸ¥çœ‹æ•ˆæœã€‚

å¯ä»¥åšåˆ°ç”¨SQLçš„è¯­æ³•æ ‘å·¥å…·ç²¾å‡†æ“ä½œSQLè¯­å¥ï¼Œè¿™æ˜¯ä½¿ç”¨æ­£åˆ™æ— æ³•åšåˆ°çš„ã€‚

æ‰¾ä¸€ä¸‹ä½ ä½¿ç”¨çš„ä¸»è¯­è¨€çš„ä¸€ä¸ªSQLè¯­æ³•æ ‘å·¥å…·ï¼Œå¹¶é˜…è¯»`api`æ–‡æ¡£ã€‚
