# standard-version: ä»¥gitæäº¤ä¸ºæ ¸å¿ƒçš„å‘å¸ƒå·¥ä½œæµ

## å…³äºè®°å½•ç¨‹åºå˜æ›´æ—¥å¿—

### Situation

* æ¯æ¬¡å‘å¸ƒä¹‹åéƒ½å¯èƒ½ä¼šæƒ³èµ·æ¥ï¼Œå¥½åƒå¿˜äº†å†™å‘å¸ƒæ—¥å¿— (ï¸¶ï¸¹ï¸º)ï¼Œå‘µå‘µï¼Œç®—äº†å°±è¿™æ ·å§ â•®(â•¯â–½â•°)â•­ã€‚

* æˆ‘ä»¬éœ€è¦å†™å‘å¸ƒæ—¥å¿—ï¼Œè¿™ä¸ªéœ€æ±‚å¯èƒ½æ¥è‡ªé¢†å¯¼ï¼Œæˆ–æ˜¯è‡ªæˆ‘é©±åŠ¨ã€‚

  > å…¶å®å¯¹äºä¸šåŠ¡å¼€å‘ï¼Œå¤§å¤šæ•°çš„å˜æ›´æ—¥å¿—æ˜¯éœ€è¦å•ç‹¬ç¼–å†™é¢å‘ç”¨æˆ·çš„æ–‡æ¡£çš„ï¼Œæœ¬æ–‡çš„å†…å®¹å¹¶ä¸é€‚ç”¨ã€‚
  >
  > ä½†å¯¹äºåŸºäºnpmå¹³å°å‘å¸ƒçš„é¡¹ç›®ï¼Œç›´æ¥å°†å˜æ›´æ—¥å¿—é›†æˆåˆ°é¡¹ç›®é¦–é¡µçš„README.mdæ–‡æ¡£ä¸­å°±ååˆ†å¿…è¦äº†ï¼Œè€Œä¸”è¿™ä¹Ÿæ˜¯ä¸€ä¸ªè¡Œä¸šé€šç”¨æƒ¯ä¾‹ã€‚

### Task

* é¡¹ç›®æœ‰äº†æ›´æ–°ä¹‹åï¼Œå¦‚ä½•å°†æ›´æ–°ç»†èŠ‚å½’æ¡£ï¼Œä»¥ä¾›ä¹‹åæŸ¥è¯¢å‘¢ï¼Ÿ

* å½’æ¡£æœ‰æ²¡æœ‰æ ¼å¼è¦æ±‚ï¼Ÿè¿›è€Œå®ç°è‡ªåŠ¨åŒ–ç”Ÿæˆã€‚

### Action

ç”±ç¬¬ä¸€ä¸ªé—®é¢˜å¸¦å‡ºçš„å¦ä¸€ä¸ªé—®é¢˜---è§„èŒƒé€‰å‹

```
              éœ€è¦è§„èŒƒå—ï¼Ÿ
              â†™      â†˜
          ä¸éœ€è¦       éœ€è¦
          â†™              â†˜
  è·Œå…¥æ‰‹åŠ¨å¤„ç†çš„æ·±æ¸Š        å¦‚ä½•å†™
      â†™                  â†™    â†˜
game over  â†  â†  è‡ªå·±éšä¾¿å†™     è§„èŒƒé€‰å‹
```

### Result

å½“æœ€ç»ˆèµ°åˆ°äº†æœ€å³ä¸‹è§’çš„è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œä»¥ä¸‹å†…å®¹å°±æ˜¯è¿™ä¸ªé€‰é¡¹çš„ä¸€ä¸ªç›¸å¯¹çš„æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚

## æ¦‚å¿µè®²è§£

### æ¦‚å¿µI [semver](https://semver.org/lang/zh-CN/) â€”â€” è¯­ä¹‰ç‰ˆæœ¬

`semver`ï¼Œå…¨ç§°ä¸º`Semantic Versioning`ï¼Œå®ƒæ—¢æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæ˜¯ä¸€ä¸ªnpmå·¥å…·ï¼Œè¯¥npmå·¥å…·å°±æ˜¯è¿™ä¸ªæ¦‚å¿µçš„ç¨‹åºå®ç°ã€‚

æˆ‘ä»¬åœ¨å®‰è£…ä¸€ä¸ª`npm package`ä¹‹åï¼Œè¯¥`package`ä¼šè‡ªåŠ¨å†™å…¥é¡¹ç›®çš„`package.json`æ–‡ä»¶ä¸­ã€‚

æ¯”å¦‚è¿™æ ·

```json
  "prettier": "^1.18.2" //â‘ 
```

å·¦è¾¹çš„éƒ¨åˆ†æ˜¯npmåŒ…çš„åå­—ï¼Œå³è¾¹æ˜¯ç‰ˆæœ¬å·ï¼Œä¸€ç›®äº†ç„¶ã€‚

#### æ•°å­—éƒ¨åˆ†ç‰ˆæœ¬å·

â‘  ç¬¦å·`^`ï¼Œç‰ˆæœ¬èŒƒå›´æç¤ºç¬¦ï¼Œæ–‡æ¡£é‡Œå«[Advanced Range Syntax](https://www.npmjs.com/package/semver#advanced-range-syntax)ã€‚

è¯¥ç¬¦å·æ˜¯ä½¿ç”¨`yarn`/`npm`å®‰è£…çš„ç‰ˆæœ¬çº¦å®šçš„é»˜è®¤è¡Œä¸ºã€‚é”å®šä»å·¦èµ·ç¬¬ä¸€ä¸ªé0çš„ç‰ˆæœ¬å·ï¼Œä¹‹åçš„ç‰ˆæœ¬å·éƒ½å¯ä»¥å‡çº§ã€‚[å‚è€ƒ](https://www.npmjs.com/package/semver#caret-ranges-123-025-004)

```text
^1.2.3 := >=1.2.3 <2.0.0
^0.2.3 := >=0.2.3 <0.3.0
^0.0.3 := >=0.0.3 <0.0.4
```

æ­¤å¤–è¿˜æœ‰ä¸€äº›é¢„å‘ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚`alpha`ã€`beta`è¿™äº›åœ¨é¦–ä¸ªç¨³å®šç‰ˆæœ¬å‘å¸ƒä¹‹å‰çš„è¯•ç”¨ç‰ˆæœ¬å·ï¼Œå¤§å®¶å¯ä»¥è¯¦ç»†é˜…è¯»æ–‡æ¡£ã€‚

å³ä¾§çš„æ•°å­—éƒ¨åˆ†ï¼Œä¸èƒ½æŒ‰æ•°å­—æ¥ç†è§£ï¼Œå…¶ä¸­çš„`.`ä¸æ˜¯æ•°å­¦ä¸Šçš„å°æ•°ç‚¹ï¼Œåªæ˜¯èµ·åˆ†å‰²ç¬¦ä½œç”¨ã€‚

ç»è¿‡`.`åˆ†å‰²ä¹‹åçš„ä¸‰éƒ¨åˆ†åˆ†åˆ«ä¸ºï¼Œä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·ã€ä¿®è®¢ç‰ˆæœ¬å·ï¼Œ[å‚è€ƒ](https://docs.npmjs.com/about-semantic-versioning)ã€‚

1. ä¸»ç‰ˆæœ¬å·: å½“å‰ç¨‹åºç»è¿‡é‡æ„ï¼Œç”Ÿæˆäº†ä¸ä¹‹å‰ç‰ˆæœ¬ä¸å…¼å®¹çš„apiï¼Œåˆ™ä¸»ç‰ˆæœ¬å·å‡çº§ã€‚ä¾‹å¦‚angularçš„å„ä¸ªå¤§ç‰ˆæœ¬ï¼Œvueçš„1ã€2ã€3ç‰ˆæœ¬ã€‚

2. æ¬¡ç‰ˆæœ¬å·: ä¹Ÿå¯ä»¥å«åŠŸèƒ½ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡åœ¨æ²¡æœ‰ç ´ååŸapiè°ƒç”¨æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•äº†æ–°apiæˆ–æ·»åŠ äº†å…¶ä»–æ–°åŠŸèƒ½ï¼Œå‡çº§çš„å°±æ˜¯æ¬¡ç‰ˆæœ¬å·ã€‚

3. ä¿®è®¢ç‰ˆæœ¬å·: æ¯æ¬¡bugä¿®æ­£å¼•èµ·çš„å‡çº§ï¼Œå³å‡çº§ä¿®æ­£ç‰ˆæœ¬å·ï¼Œä¿®è®¢ç‰ˆæœ¬å·çš„å˜åŒ–æ—¢ä¸ä¼šå¼•èµ·apiè°ƒç”¨çš„å˜åŒ–ï¼Œä¹Ÿæ²¡æœ‰æ–°çš„æ‰©å±•åŠŸèƒ½ï¼Œå¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œæ˜¯å¯ä»¥å¹³æ»‘å‡çº§çš„å®‰å…¨å­˜åœ¨ã€‚

### æ¦‚å¿µII GITæäº¤æ ¼å¼

ä¸ºäº†é…åˆä¸Šé¢è®²è¿°çš„`semver`ï¼Œå¯¹äº`git`çš„æäº¤æè¿°å°±æœ‰äº†ä¸€ç³»åˆ—çš„è¯¦ç»†è§„åˆ™ã€‚

æˆ‘ä»¬åœ¨ä½¿ç”¨`git commit`æ—¶ï¼Œéœ€è¦å¡«å†™çš„æäº¤å†…å®¹ï¼Œéœ€è¦ç¬¦åˆä»¥ä¸‹æ ¼å¼ã€‚

```text
  type(scope): subject
  // ç©ºè¡Œ
  body
  // ç©ºè¡Œ
  footer
```

#### å¿…å¡«é¡¹: `type`ã€`subject`

##### typeå«ä¹‰

* `type`æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œä¸šç•Œé€šç”¨çš„é€‰é¡¹å¦‚ä¸‹

| æšä¸¾å€¼ | å«ä¹‰ |
| ------ | ---- |
| build | æ„å»ºç›¸å…³ |
| ci | æŒç»­é›†æˆç›¸å…³ |
| chore | å…¶ä»–æƒ…å†µ |
| docs | æ–‡æ¡£ |
| feat | ç‰¹æ€§ |
| fix | bugä¿®æ­£ |
| perf | æ€§èƒ½ä¼˜åŒ– |
| refactor | å’Œç‰¹æ€§ä¿®æ­£æ— å…³çš„é‡æ„ï¼Œä¾‹å¦‚é‡å‘½å |
| revert | ç”±äºä¹‹å‰çš„æŸä¸ªé”™è¯¯æäº¤ï¼Œç”Ÿæˆæ¢å¤ä»£ç çš„ä¸€æ¬¡æäº¤ |
| style | ç¼–ç é£æ ¼ç›¸å…³ |
| test | æµ‹è¯• |

å‚è€ƒ [é˜®ä¸€å³°æ•™ç¨‹ Commit message å’Œ Change log ç¼–å†™æŒ‡å—](http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)ï¼Œå…¶ä¸­ç¬¬å››ã€äº”éƒ¨åˆ†å†…å®¹å·²ç»è¿‡æœŸï¼Œå·²æœ‰ç°æˆçš„æˆç†Ÿå·¥å…·ï¼Œä¸å†éœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚

* `subject`: å…³äºå½“å‰æäº¤çš„ä¸€ä¸ªæœ€ç®€åŒ–æè¿°

#### é€‰å¡«é¡¹: `scope`ã€`body`ã€`footer`

* scope å½“å‰è½¯ä»¶é¡¹ç›®çš„å†…éƒ¨åˆ†ç±»åï¼Œæ²¡æœ‰å›ºå®šé€‰é¡¹å€¼ï¼ŒæŒ‰éœ€å¡«å†™ï¼Œä¾‹å¦‚coreã€cliã€rulesã€‚

* body è¯¦ç»†æè¿°ï¼Œæ ¹æ®å®é™…éœ€è¦å¡«å†™å³å¯ï¼Œæ”¯æŒmarkdownæ ¼å¼ã€‚

æ¨èbodyå†™æˆmarkdownæ ¼å¼ï¼Œåœ¨æœ€ç»ˆçš„`CHANGELOG.md`æ–‡ä»¶ä¸­æ˜¾ç¤ºçš„ä¼šæ›´å¥½çœ‹ã€‚

```
feat(cli): æ·»åŠ å‘½ä»¤è¡Œå‚æ•°-p

* -påé¢å¯ä»¥æŒ‡å®šä¸€ä¸ªåç§°ï¼Œä¾‹å¦‚`-p prjectA`
* -påé¢å¯ä»¥æŒ‡å®šå¤šä¸ªåç§°ï¼Œç”¨`,`åˆ†å‰²ï¼Œä¾‹å¦‚`-p prjectA,projectB`
```

* footerï¼ŒåªåŒ…å«ä¸¤ç§æƒ…å†µ:

  * ä¸å…¼å®¹å˜åŠ¨ï¼Œä¾‹å¦‚: `BREAKING CHANGE: apiæ–¹æ³•æ”¹å.`

  * å…³é—­Issueï¼Œä¾‹å¦‚: `Closes #234`

## åœ¨è®²è§£ä¹‹åæ¦‚å¿µä¹‹å‰ï¼Œå°†ç»“åˆä¸€ä¸ªç¤ºä¾‹å·¥ç¨‹åº”ç”¨ä¸Šè¿°æ¦‚å¿µ

ğŸ§ åœ¨è¯¥ç¤ºä¾‹ä¸­ä½¿ç”¨`yarn`ä»£æ›¿`npm`ã€‚

ä¸Šé¢è®²è§£äº† **semverç‰ˆæœ¬å·ç®¡ç†** ä¸ **gitæäº¤è§„åˆ™** è¿™ä¸¤ä¸ªæ¦‚å¿µä¹‹åï¼Œä»¥ä¸‹ç”¨ä¸€ä¸ªå®é™…å·¥ç¨‹å¼•å…¥ä¸€äº›å·¥å…·æ¼”ç¤ºåœ¨ç”Ÿäº§ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ

### å·¥ç¨‹ç¤ºä¾‹

#### å…ˆå‡†å¤‡ç¤ºä¾‹é¡¹ç›®

<details><summary>åˆå§‹åŒ–å·¥ç¨‹</summary>

```sh
mkdir example
cd example
yarn init -y
git init
echo node_modules > .gitignore
```

![](./media/initExample.apng)

</details>

#### å°†gitæäº¤æŒ‰ä¸Šé¢çš„æäº¤è§„èŒƒèµ·æ¥

é¦–å…ˆéœ€è¦æŠŠæˆ‘ä»¬çš„`git`æäº¤è§„èŒƒèµ·æ¥ã€‚

æˆ‘ä¸€ç›´ç›¸ä¿¡çš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œäººæ˜¯é ä¸ä½çš„ï¼Œå¿…é¡»ç”¨å·¥å…·æ¥ç»Ÿä¸€çº¦æŸã€‚

å¯¹å›¢é˜Ÿå¦‚æ­¤ï¼Œå¯¹ä¸ªäººä¹Ÿæ˜¯å¦‚æ­¤ï¼Œäººçš„æƒ°æ€§éœ€è¦é å¤–ç½®å·¥å…·æ¥çº¦æŸã€‚

##### gitæäº¤å†…å®¹æ ¡éªŒå·¥å…·: `commitlint`

* [commitlint](https://www.npmjs.com/package/commitlint) æ£€æµ‹æ¯æ¬¡æäº¤çš„æ ¼å¼æ ¸å¿ƒä»£ç åŒ…ã€‚

* [commitlint-cli](https://www.npmjs.com/package/@commitlint/prompt-cli) `commitlint`çš„å‘½ä»¤è¡Œæ‰©å±•ã€‚

  [commitlinté…å¥—è§„åˆ™å‚è€ƒ](https://github.com/conventional-changelog/commitlint#shared-configuration)

* [@commitlint/config-conventional](https://www.npmjs.com/package/@commitlint/config-conventional) å…¶ä¸­ä¸€ç§æˆ‘å¸¸ç”¨çš„éªŒè¯è§„åˆ™é›†ï¼Œä¹‹åçš„è®²è§£éƒ½ä»¥è¯¥è§„åˆ™é›†ä¸ºä¾‹ã€‚

  > âš ï¸  æ³¨æ„: ä¸åŒçš„lintè§„åˆ™ï¼Œå¯é€‰çš„typeå¯èƒ½ç¨æœ‰ä¸åŒï¼Œä»¥ä¸‹éƒ½ä»¥conventionalçš„è§„åˆ™é›†ä¸ºè§„åˆ™é›†è¿›è¡Œ

<details><summary>å®‰è£…`commitlint`ç³»åˆ—å·¥å…·ï¼Œå¹¶æ·»åŠ é…ç½®</summary>

å®‰è£…ï¼Œå¹¶æ·»åŠ é…ç½®`commitlint.config.js`ï¼Œæ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚

```sh
# å®‰è£…å·¥å…·
yarn add -D commitlint @commitlint/prompt-cli @commitlint/config-conventional
# æ·»åŠ é…ç½®
echo "module.exports = { extends: ['@commitlint/config-conventional'] }" > commitlint.config.js
```

![](./media/installCommitlint.apng)

å®‰è£…å®Œæ¯•åï¼Œç”¨å‘½ä»¤å®éªŒï¼Œä¼šå‡ºç°è§„åˆ™æ ¡éªŒå¤±è´¥çš„æç¤ºã€‚

```bash
echo 'xxx: yyy' | npx commitlint
```

![](./media/runCommitlint.apng)

</details>

##### `commitlint`è¾…åŠ©å·¥å…·[commitizen](https://www.npmjs.com/package/commitizen)

ä¸€ä¸ªå‘½ä»¤è¡Œä¸‹ï¼Œç”¨äº¤äº’çš„æ–¹å¼ç”Ÿæˆåˆè§„çš„æäº¤æ ¼å¼çš„å·¥å…·ï¼Œå¯¹äºè¿˜ä¸ç†Ÿæ‚‰æäº¤æ¶ˆæ¯æ ¼å¼çš„äººèµ·åˆ°è‡ªåŠ¨ç”Ÿæˆåˆè§„æ¶ˆæ¯çš„ä½œç”¨ï¼Œå¯æœ‰å¯æ— ã€‚

* ä¸`commitizen`é…å¥—çš„è§„åˆ™åŒ…`cz-conventional-changelog`ã€‚

<details><summary>å®‰è£…`commitizen`ä¸é…å¥—è§„åˆ™ï¼Œå¹¶é…ç½®</summary>

```sh
# å®‰è£…å·¥å…·
yarn add commitizen cz-conventional-changelog -D
# æ·»åŠ é…ç½®
echo '{ "path": "cz-conventional-changelog" }' > .czrc
```

![](./media/installCommitizen.apng)

</details>

å®‰è£…å®Œæ¯•ä¹‹åï¼Œå³å¯ä½¿ç”¨`git-cz`å‘½ä»¤ä»£æ›¿`git commit`æäº¤ã€‚

<details><summary>è¿è¡Œ`commitizen`</summary>

```sh
yarn git-cz
```

![](./media/runCommitizen.apng)

</details>

åˆ°æ­¤ä¹‹åï¼Œæˆ‘ä»¬éšä¾¿å°è¯•ç”Ÿæˆä¸€æ¬¡æ™®é€šçš„æäº¤ã€‚

ğŸ¤” ä¸ºä»€ä¹ˆä¸åˆè§„çš„å†…å®¹è¿˜æ˜¯å¯ä»¥æäº¤å‘¢ï¼Ÿ

æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæŠŠæ ¡éªŒè§„åˆ™å’Œæ¯æ¬¡çš„æäº¤åŠ¨ä½œå¼ºåˆ¶å…³è”èµ·æ¥çš„ç¯èŠ‚ã€‚

### æ¦‚å¿µIII: git hooks

å¥½æ¯”`React`æˆ–`Vue`ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æŒ‚è½½å‰ã€åï¼Œéƒ½å¯ä»¥æ’å…¥ä¸€äº›è‡ªå®šä¹‰è¡Œä¸ºï¼Œåœ¨`git`çš„è¿™ä¸ªæ¦‚å¿µä¸Šï¼Œè¯¥è¡Œä¸ºç§°ä¸º`git hooks`ï¼Œ[å‚è€ƒ](https://www.git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90)ã€‚`git hooks`åˆåˆ†ä¸º **æœåŠ¡ç«¯** è¿è¡Œå’Œ **æœ¬åœ°** è¿è¡Œï¼Œä»¥ä¸‹æ‰€è®²çš„å…¨éƒ½æ˜¯ **æœ¬åœ°** è¿è¡Œ`hooks`ã€‚

### `githook`å·¥å…·ä»‹ç»

å°†`commitlint`ç»‘å®šåˆ°`git`çš„`commit-msg`æäº¤é’©å­ä¸Šï¼Œåœ¨æ¯æ¬¡ç”Ÿæˆæäº¤å‰è°ƒç”¨`commitlint`æ£€æµ‹æäº¤æ–‡å­—æ ¼å¼ï¼Œä¸é€šè¿‡éªŒè¯åˆ™æ— æ³•ç”Ÿæˆæäº¤ã€‚

* [yorkie](https://www.npmjs.com/package/yorkie)

![](./media/yorkie.png)

å®‰è£…yorkie:

```sh
yarn add yorkie
```

åœ¨package.jsonæ–‡ä»¶ä¸­æ·»åŠ æäº¤æ¶ˆæ¯éªŒè¯

yorkieé…ç½®ï¼Œåœ¨package.jsonä¸­

```javascript
"gitHooks": {
  "commit-msg": "npx commitlint -E GIT_PARAMS"
}
```

* [husky](https://www.npmjs.org/package/husky)

![](./media/husky.png)

å®‰è£…:

```sh
yarn add husky
```

huskyé…ç½®ï¼Œåœ¨package.jsonä¸­

```javascript
"husky": {
  "hooks": {
    "commit-msg": "npx commitlint -E HUSKY_GIT_PARAMS"
  }
},
```

ä¸¤ä¸ªå·¥å…·éƒ½ä¸é”™ï¼Œ`husky`çš„é”™è¯¯æç¤ºä¿¡æ¯å¯èƒ½æ›´å¥½ä¸€äº›

ğŸ¾ å¿…é¡»å…ˆå°†é¡¹ç›®çº³å…¥gitç®¡ç†ï¼Œå†å®‰è£…husky/yorkieï¼Œå¦åˆ™ä¸ä¼šå®‰è£…git hooks

<details><summary>å…³äº`githooks`çš„è¡¥å……è¯´æ˜</summary>

git hooksåˆ†ä¸ºæœåŠ¡å™¨hookå’Œæœ¬åœ°hookï¼Œæ­¤å¤„è®²çš„å…¨éƒ¨éƒ½æ˜¯æœ¬åœ°hookã€‚

è¯¦ç»†çš„hooksè¯´æ˜éœ€è¦çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæƒ³ä¸èµ·æ¥çš„æ—¶å€™ï¼Œå¯ä»¥å¿«é€Ÿçœ‹ä¸€ä¸‹å½“å‰é¡¹ç›®é‡Œçš„`.git/hooks`æ–‡ä»¶å¤¹ï¼Œé‡Œé¢çš„æ–‡ä»¶å°±æ˜¯å½“å‰æœ¬åœ°gitæ”¯æŒçš„hookï¼Œè¿™äº›æ–‡ä»¶éƒ½æ˜¯è§åçŸ¥æ„çš„ã€‚

![localhooks](./media/localGithooks.png)

æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å…¶ä»–çš„`git`ç”Ÿå‘½å‘¨æœŸä¸­æ³¨å…¥`hooks`ï¼Œä¾‹å¦‚`pre-commit/pre-push`è‡ªåŠ¨è¿è¡Œæµ‹è¯•ç­‰ï¼Œæµ‹è¯•ä¸é€šè¿‡åˆ™é˜»æ­¢æäº¤/æ¨é€ã€‚

</details>

### æ¦‚å¿µIV: CHANGELOG

ç»è¿‡äº†ä¹‹å‰è¿™ä¹ˆå¤šé“ºå«ï¼Œç»ˆäºå›åˆ°æœ€åˆå˜æ›´æ—¥å¿—è¿™ä¸ªç›®æ ‡ä¸Šäº†ã€‚

ä¸ºgitæäº¤å†…å®¹æ·»åŠ å„ç§æ ¡éªŒï¼Œå…¶ç›®çš„å°±æ˜¯ä¸ºäº†ç”Ÿæˆå¯ä»¥å…·æœ‰å›ºå®šè§„åˆ™ä»è€Œå¯ä»¥è¢«æå–çš„æ—¥å¿—è®°å½•ï¼Œç”Ÿæˆå½“å‰å‘å¸ƒç‰ˆæœ¬çš„`CHANGELOG.md`ã€‚

* å·¥å…·[conventional-changelog-cli](https://www.npmjs.com/package/conventional-changelog-cli)

  ç›¸ä¼¼çš„è§„åˆ™é›†å¯è§[conventional-changelog packages](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages)
ä»¥ä¸‹éƒ½ä»¥`conventionalcommits`ä¸ºé»˜è®¤è§„åˆ™é›†åˆ

å®‰è£…:

```sh
yarn add conventional-changelog-cli conventional-changelog-conventionalcommits -D
```

ç”Ÿæˆæ—¥å¿—:

```sh
npx conventional-changelog -p conventional -i CHANGELOG.md -s -r 0
```

conventional-changelogæœ‰å¾ˆå¤šå¯è°ƒæ•´çš„å‚æ•°ï¼Œå…·ä½“å‚è€ƒ[conventional-changelogæ–‡æ¡£](https://www.npmjs.com/package/conventional-changelog-cli)å³å¯ã€‚

æ‰§è¡Œä¹‹åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆæ›´æ–°æ—¥å¿—`CHANGELOG.md`æ–‡ä»¶ã€‚

ğŸ¾ æ¯æ¬¡éœ€è¦å˜æ›´ç‰ˆæœ¬å·å‘å¸ƒä¹‹å‰ï¼Œæ‰éœ€è¦ç”Ÿæˆchangelogï¼Œä¸éœ€è¦æ¯æ¬¡ä¿®æ”¹æˆ–æäº¤éƒ½ç”Ÿæˆã€‚

### åˆæˆ˜: é›†æˆ

#### å·¥å…·: standard-version

é™¤å‘å¸ƒä¹‹å¤–çš„å…¨è‡ªåŠ¨åŒ–å·¥å…·

<details><summary>è¿è¡Œ`standard-version`</summary>

å®‰è£…:

```bash
yarn add standard-version
```

æ‰§è¡Œ:

```bash
npx standard-version
```

![è¿è¡Œç¤ºä¾‹](./media/runStandardVersion.apng)

</details>

å…¶è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š

```sh
æ”¶é›†ä¸Šä¸€æ¬¡æ‰“tagçš„versionåˆ°å½“å‰ä¸ºæ­¢æ˜¯å¦æœ‰featå’Œfixæˆ–BREAKING CHANGE
                  |
if æœ‰BREAKING CHANGEï¼Œåˆ™è‡ªåŠ¨å‡çº§majorç‰ˆæœ¬å·
                  |
else if æœ‰ä»»ä½•ä¸€ä¸ªfeatï¼Œåˆ™è‡ªåŠ¨å‡çº§minorç‰ˆæœ¬å·
                  |
else if æœ‰featï¼Œæœ‰fixï¼Œåˆ™è‡ªåŠ¨å‡çº§patchç‰ˆæœ¬å·
                  |
            ç”Ÿæˆæ–°ç‰ˆæœ¬å·
                  |
å°†æ–°ç‰ˆæœ¬å·å†™å…¥`package.json`
                  |
è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå†…å®¹ä¸º`chore(release): x.x.x`çš„æäº¤
                  |
      å°†æœ€æ–°çš„æäº¤ä¸Šæ·»åŠ ç‰ˆæœ¬`git tag`ï¼Œä¸`pakcage.json`ä¸­çš„ä¸€è‡´
                  |
æ ¹æ®æ”¶é›†çš„æäº¤è®°å½•æ±‡æ€»ï¼Œç”Ÿæˆæœ€æ–°`CHANGELOG.md`
```

ğŸ’ æ— è®ºæ˜¯å…¬ç½‘npmå¹³å°è¿˜æ˜¯å†…éƒ¨npmå¹³å°ï¼Œåªè¦å‘å¸ƒç‰ˆæœ¬å°±æ— æ³•æ’¤é”€ã€‚

å› æ­¤éœ€è¦ä½¿ç”¨`npm publish --dry-run`æ¨¡æ‹Ÿå‘å¸ƒæµç¨‹ï¼Œè‡ªåŠ¨è°ƒç”¨`prepublishOnly`æ¥ã€‚

#### ğŸ¾ `1.0.0`ä¹‹å‰ä¸ä¹‹åçš„ä¸¤ç§ç­–ç•¥

* âš ï¸  è¯¥å·¥å…·å°†æ‰€æœ‰å°äº`1.0.0`çš„ç‰ˆæœ¬éƒ½è§†ä¸ºéæ­£å¼ç‰ˆæœ¬ï¼Œæ¯”å¦‚`alpha`æˆ–`beta`ç‰ˆã€‚åœ¨å°äº`1.0.0`æ—¶æ‰€æœ‰`BREAKING CHANGE`éƒ½ä¸ä¼šå‡ä¸»ç‰ˆæœ¬å·(å› ä¸ºè½¯ä»¶è¿˜æ²¡æœ‰å‘å¸ƒï¼Œä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆç ´åå…¼å®¹é—®é¢˜)ï¼Œåªä¼šå‡çº§`minor`ç‰ˆæœ¬å·ã€‚åœ¨å°äº`1.0.0`æ—¶æ‰€æœ‰`feat`éƒ½ä¸ä¼šå‡`minor`ç‰ˆæœ¬å·ï¼Œåªä¼šå‡çº§`patch`ç‰ˆæœ¬å·ã€‚

* âš ï¸  å¦‚æœä¸Šæ¬¡ä¸æœ¬æ¬¡å‘å¸ƒä¹‹é—´æ²¡æœ‰å¯ä»¥å‡çº§çš„`git tag`ï¼Œåˆ™ä¼šè‡ªåŠ¨å°†patchç‰ˆæœ¬å·å‡çº§

è‡ªåŠ¨ç”Ÿæˆæ–°çš„`CHANGELOG.md`

#### ä¸npmå‘å¸ƒæµç¨‹é…åˆ

åœ¨`package.json`ä¸­æ·»åŠ å‘å¸ƒhook

é€šå¸¸åœ¨`prepublishOnly`ä¸­æ·»åŠ ï¼Œå†æ‰“åŒ…ç¼–è¯‘ï¼Œç„¶åè‡ªåŠ¨å‡çº§ç‰ˆæœ¬çš„å‘å¸ƒæµç¨‹ã€‚

```json
{
  "scripts": {
    "release": "npx standard-version",
    "prepublishOnly": "yarn build && yarn release"
  }
}
```

ğŸ¾ å°†`standard-version`çš„æ‰§è¡Œæ”¾åˆ°ç¼–è¯‘ä¸æµ‹è¯•ç­‰çš„åé¢ï¼Œå¦åˆ™å¦‚æœå…ˆç”Ÿæˆäº†ç‰ˆæœ¬å·ï¼Œä½†æµ‹è¯•æˆ–ç¼–è¯‘å¤±è´¥äº†ï¼Œéœ€è¦æ‰‹åŠ¨gitå›æ»šï¼Œåˆ é™¤CHANGELOGå†…å®¹ï¼Œå»æ‰git tagç­‰ä¸€ç³»åˆ—é”™è¯¯; æˆ–è€…çœäº‹ç‚¹ï¼Œå¿½ç•¥å¤±è´¥çš„ç‰ˆæœ¬å·ï¼Œä¿®æ”¹åä¸‹æ¬¡å†å‘å¸ƒã€‚

## æ€»ç»“: ä»¥ä¸Šæ‰€æœ‰å·¥å…·ä¹‹é—´çš„å…³ç³»

![git release flow](./git-release-flow.png)

ç”¨æ›´ç®€å•ä¸€äº›çš„å›¾æ¥è¡¨ç¤ºå…³ç³»

### ãŠ§:æœ€ç®€åŒ–æ‰§è¡Œçš„æµç¨‹ â€”â€”â€”â€”â€”â€”â€”â€”â€” ãŠ¨: æ·»åŠ çš„è°ƒç”¨å…³ç³»çš„è¯¦ç»†æµç¨‹
```
               ãŠ§                               ãŠ¨
                                           before gitæäº¤
                                          è‡ªåŠ¨è°ƒç”¨git hook
                                           commintlintæ ¡éªŒ
                                                 â†“
            gitæäº¤                           gitæäº¤
               â†“                      â†™          â†“            â†˜
               â†“                     â†“   before (npm publish)  â†“
               â†“                     â†“ è‡ªåŠ¨è°ƒç”¨standard-version  â†“
               â†“                     â†“           â†“              â†“
               â†“                     â†“        è‡ªåŠ¨æå‡ç‰ˆæœ¬      â†“
               â†“                      â†˜   ç”ŸæˆCHANGELOG.md     â†™
               â†“                                 â†“ 
               â†“                                 â†“ 
               â†“                                 â†“ 
          npm publish                         npm publish
```
